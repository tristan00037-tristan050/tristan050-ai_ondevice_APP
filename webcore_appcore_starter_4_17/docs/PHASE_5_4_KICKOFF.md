# Phase 5.4 킥오프 문서

Phase 5.3 (UI/Dashboard) 및 R5d 작업 완료 후, Phase 5.4 작업을 시작하기 위한 킥오프 문서입니다.

## 📋 현재 상태 (Phase 5.3 완료)

### 완료된 작업

#### Phase 5.3 UI/Dashboard (R5c)
- ✅ Ops Console (Vite+React+TypeScript)
- ✅ 리포트 목록/필터/페이지네이션
- ✅ 리포트 상세 + 서명/번들 다운로드
- ✅ 타임라인 (24/48/72/168h)
- ✅ ETag/If-None-Match 지원 클라이언트

#### R5d 작업
- ✅ r5d-1: 서버 측 필터링 (P0 결함 수정)
- ✅ r5d-2: 서명 감사 로그 API
- ✅ r5d-3: 번들 메타 정보 API
- ✅ r5d-4: 타임라인 API severity 집계
- ✅ r5d-5: 권한 레벨 (클라이언트 사이드)

### 기술 스택
- **Collector**: Node.js + Express + TypeScript
- **Ops Console**: Vite + React + TypeScript + Tailwind CSS
- **App**: Expo + React Native
- **BFF**: Node.js + Express

---

## 🎯 Phase 5.4 목표

Phase 5.4는 **운영 안정성 및 확장성 강화**에 초점을 맞춥니다.

### 핵심 목표
1. **데이터 영속성**: 인메모리 저장소 → 데이터베이스 연동
2. **모니터링/관측성**: 메트릭, 로깅, 트레이싱 강화
3. **성능 최적화**: 쿼리 최적화, 캐싱 전략
4. **운영 자동화**: 배포, 스케일링, 백업 자동화
5. **보안 강화**: 추가 보안 레이어, 감사 로그 강화

---

## 📋 Phase 5.4 작업 계획

### 1. 데이터베이스 연동 (우선순위: P0)

**목표**: 인메모리 저장소를 실제 데이터베이스로 교체

**작업 항목**:
- [ ] 데이터베이스 선택 및 스키마 설계
  - 옵션: PostgreSQL, MongoDB, SQLite
  - 리포트, 서명 이력, 타임라인 집계 데이터 스키마
- [ ] Collector 데이터베이스 연동
  - 리포트 저장/조회
  - 서명 이력 저장/조회
  - 타임라인 집계 쿼리 최적화
- [ ] 마이그레이션 스크립트
  - 인메모리 → 데이터베이스 마이그레이션
  - 롤백 전략
- [ ] 트랜잭션 관리
  - 리포트 저장 시 원자성 보장
  - 서명 이력 저장 시 일관성 보장

**예상 기간**: 2-3 스프린트

---

### 2. 모니터링 및 관측성 강화 (우선순위: P1)

**목표**: 운영 환경에서의 가시성 확보

**작업 항목**:
- [ ] 메트릭 수집
  - Prometheus 메트릭 엔드포인트 (`/metrics`)
  - 리포트 수집률, API 응답 시간, 에러율
  - 서명 요청 수, 번들 다운로드 수
- [ ] 구조화된 로깅
  - Winston/Pino 로거 통합
  - 로그 레벨 관리 (debug, info, warn, error)
  - 로그 집계 및 검색 (ELK Stack 또는 CloudWatch)
- [ ] 분산 트레이싱
  - OpenTelemetry 통합
  - 요청 추적 (요청 ID 기반)
  - 성능 병목 지점 식별
- [ ] 헬스 체크 강화
  - 데이터베이스 연결 상태 확인
  - 외부 서비스 의존성 확인
  - 상세 헬스 체크 엔드포인트 (`/health/detailed`)

**예상 기간**: 1-2 스프린트

---

### 3. 성능 최적화 (우선순위: P1)

**목표**: 대규모 데이터 처리 및 높은 동시성 지원

**작업 항목**:
- [ ] 데이터베이스 쿼리 최적화
  - 인덱스 추가 (tenantId, createdAt, severity)
  - 쿼리 실행 계획 분석
  - N+1 쿼리 문제 해결
- [ ] 캐싱 전략
  - Redis 캐시 통합
  - 리포트 목록 캐싱 (TTL 기반)
  - 타임라인 집계 결과 캐싱
- [ ] 페이지네이션 최적화
  - 커서 기반 페이지네이션 (대용량 데이터)
  - 오프셋 기반 페이지네이션 개선
- [ ] 배치 처리
  - 대량 리포트 인제스트 최적화
  - 타임라인 집계 배치 처리

**예상 기간**: 1-2 스프린트

---

### 4. 운영 자동화 (우선순위: P2)

**목표**: 배포 및 운영 프로세스 자동화

**작업 항목**:
- [ ] CI/CD 파이프라인 강화
  - 자동 테스트 (단위, 통합, E2E)
  - 자동 배포 (스테이징, 프로덕션)
  - 롤백 자동화
- [ ] 인프라 자동화
  - Docker 컨테이너화
  - Kubernetes 배포 매니페스트
  - 자동 스케일링 설정
- [ ] 백업 자동화
  - 데이터베이스 정기 백업
  - 백업 검증 및 복원 테스트
- [ ] 알림 시스템
  - 에러 알림 (Slack, PagerDuty)
  - 성능 저하 알림
  - 용량 임계값 알림

**예상 기간**: 2-3 스프린트

---

### 5. 보안 강화 (우선순위: P1)

**목표**: 추가 보안 레이어 및 감사 강화

**작업 항목**:
- [ ] API Rate Limiting
  - 테넌트별 요청 제한
  - IP 기반 제한
  - 토큰 기반 제한
- [ ] 감사 로그 강화
  - 모든 API 요청 로깅
  - 사용자 활동 추적
  - 보안 이벤트 감지
- [ ] 입력 검증 강화
  - SQL Injection 방지
  - XSS 방지
  - CSRF 보호
- [ ] 암호화
  - 민감 데이터 암호화 (at rest)
  - 전송 중 암호화 (TLS)
  - API Key 암호화 저장

**예상 기간**: 1-2 스프린트

---

## 🔒 불변 원칙 유지

Phase 5.4 작업 중에도 다음 불변 원칙을 유지합니다:

1. **웹 코어 기준선 고정**: web-core-4.17.0(4054c04) 유지보수 모드
2. **정책/리포트 스키마 준수**: Ajv 검증(앱/Collector), CI 스키마 게이트 유지
3. **라벨 화이트리스트**: decision|ok 유지
4. **오프라인 우선**: 앱 업로더 큐(민감정보 미저장), 지수 백오프+지터
5. **테넌트 격리**: Collector 전 엔드포인트 강제 가드 + /bundle.zip 토큰 교차검증
6. **ETag 최적화**: 목록 정렬 고정/MD5 ETag 안정화, UI 304 활용
7. **OpenAPI/타입**: BFF/Collector 명세 → 타입 생성/동기화

---

## 📊 우선순위 매트릭스

| 작업 | 우선순위 | 예상 기간 | 의존성 |
|------|---------|----------|--------|
| 데이터베이스 연동 | P0 | 2-3 스프린트 | 없음 |
| 모니터링/관측성 | P1 | 1-2 스프린트 | 데이터베이스 연동 |
| 성능 최적화 | P1 | 1-2 스프린트 | 데이터베이스 연동 |
| 보안 강화 | P1 | 1-2 스프린트 | 없음 |
| 운영 자동화 | P2 | 2-3 스프린트 | 모든 P0/P1 작업 |

---

## 🧪 DoR (Definition of Ready)

Phase 5.4 작업을 시작하기 전에 다음 조건을 만족해야 합니다:

- ✅ Phase 5.3 완료 확인
- ✅ R5d 작업 완료 확인
- ✅ P0 결함(r5d-1) 해결 확인
- ✅ 코드 품질 게이트 통과 (ESLint, TypeScript)
- ✅ CI/CD 파이프라인 정상 작동

---

## 🧪 DoD (Definition of Done)

각 Phase 5.4 작업이 완료되려면 다음 조건을 만족해야 합니다:

### 데이터베이스 연동
- ✅ 인메모리 저장소 완전 제거
- ✅ 모든 데이터가 데이터베이스에 저장됨
- ✅ 마이그레이션 스크립트 검증 완료
- ✅ 트랜잭션 일관성 보장
- ✅ 성능 테스트 통과 (응답 시간 < 200ms)

### 모니터링/관측성
- ✅ 메트릭 엔드포인트 동작 확인
- ✅ 로그 집계 시스템 연동 완료
- ✅ 트레이싱 시스템 연동 완료
- ✅ 알림 시스템 동작 확인

### 성능 최적화
- ✅ 쿼리 실행 시간 개선 (50% 이상)
- ✅ 캐시 히트율 > 80%
- ✅ 동시 요청 처리 능력 향상 (100+ req/s)

### 보안 강화
- ✅ Rate Limiting 동작 확인
- ✅ 감사 로그 수집 확인
- ✅ 보안 스캔 통과 (OWASP Top 10)

### 운영 자동화
- ✅ CI/CD 파이프라인 자동 배포 확인
- ✅ 자동 스케일링 동작 확인
- ✅ 백업/복원 프로세스 검증 완료

---

## 📚 참고 문서

- `docs/PHASE_5_3_UI.md` - Phase 5.3 UI/Dashboard
- `docs/R5D2_5_SERVERSIDE_V1.md` - R5d-2 ~ R5d-5 서버사이드 구현
- `docs/P0_R5D1_FIX.md` - P0 결함 수정
- `docs/R5B_FIXES.md` - R5b P0/P1 보완 사항

---

## 🚀 다음 단계

1. **Phase 5.4 킥오프 미팅**: 팀과 목표 및 우선순위 공유
2. **데이터베이스 선택**: 요구사항에 맞는 데이터베이스 선택
3. **스프린트 계획**: 첫 번째 스프린트 작업 항목 선정
4. **개발 시작**: 데이터베이스 연동 작업 시작

---

**버전**: Phase 5.4 킥오프 v1
**날짜**: 2025-01-XX
**기준선**: web-core-4.17.0(4054c04)
**Phase 5.3 상태**: ✅ 완료

