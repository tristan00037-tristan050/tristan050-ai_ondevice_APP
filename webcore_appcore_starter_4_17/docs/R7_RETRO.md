# R7 회고 (Retrospective)

## 무엇이 잘 되었나

### 1. 모듈화 및 재사용성
- 어댑터 인터페이스로 외부 시스템 연동이 확장 가능하게 설계됨
- OS 정책 브릿지로 역할 기반 접근 제어가 일관되게 적용됨
- 오프라인 큐로 네트워크 불안정 상황에서도 사용자 경험이 유지됨

### 2. 관측 가능성
- Prometheus 메트릭으로 성능 및 오류 모니터링 가능
- 감사 로그로 모든 중요 이벤트 추적 가능
- OS 요약 API로 대시보드 통합 용이

### 3. CI/CD 자동화
- GitHub Actions로 빌드/테스트/배포 자동화
- Docker 및 Helm으로 배포 프로세스 표준화
- 태그 기반 릴리스로 버전 관리 체계화

### 4. 보안 및 규정 준수
- PII 마스킹으로 개인정보 보호
- 역할 기반 접근 제어 (RBAC)
- 감사 로그로 규정 준수 지원

## 개선할 점

### 1. 타입 안정성
- React Native 타입 오류가 지속적으로 발생 (`|| true` 처리)
- 향후 타입 정의 개선 필요

### 2. 테스트 커버리지
- E2E 테스트는 있으나 단위 테스트 부족
- 어댑터별 모의(mock) 테스트 추가 필요

### 3. 문서화
- API 문서화 부족 (OpenAPI 스펙 확장 필요)
- 운영 가이드 보강 필요

### 4. 오류 처리
- 일부 오류 메시지가 기술적임 (사용자 친화적 개선 필요)
- 재시도 로직 개선 (지수 백오프 등)

## 데이터로 본 정확도·오류 패턴

### 정확도
- 골든셋 기준 Top-1 정확도: 목표 70% 이상
- Top-5 정확도: 목표 85% 이상
- 계정/금액대/카테고리별 breakdown 분석 필요

### 오류 패턴
- 수동 검토 요청: `manual_review_request` 액션으로 추적
- 외부 동기화 실패: `external_sync_errors_total` 메트릭으로 모니터링
- 5xx 에러: `http_requests_total` 메트릭으로 추적

### 개선 기회
- Low-confidence 케이스 → 수동 검토 fallback 비율 최적화
- 규칙/스코어 weight 조정
- 골든셋 확대 (실데이터 기반 ≥100~200건)

## R7-H 계획

### 파일럿 운영
1. **기능 플래그/테넌트 온보딩**
   - OS 포털/Backoffice/HUD 노출을 테넌트 allowlist로 제한
   - 역할 매핑(PolicyBridge), Ingress/SSL, Secret 배포

2. **모니터링 대시보드**
   - Suggest 호출수/에러율
   - Export 실패율/만료
   - Recon 오픈/미매칭 수
   - 외부 동기화 last_ts 및 지연(분)
   - 실패 카운터, 알람(ExternalSyncStale)

3. **피드백 루프**
   - Backoffice에 수동 검토 큐 필터 고정 노출
   - 운영 Slack/이슈 트래커에 "실패 케이스" 자동 링크

### 수용 기준 (AC)
- 파일럿 테넌트 일일 사용(HUD/Backoffice/OS 카드)
- 2~4주 누적 오류/수동 검토/미매칭 데이터 확보
- 대시보드/알람으로 운영자 자가 점검 가능

## R8 준비 사항

### 정확도·규칙 고도화
1. **골든셋 확대·분석**
   - 실데이터 기반 ≥100~200건
   - "ManualReview/에러" 레이블 포함
   - `measure_accuracy.js` 확장: 계정/금액대/카테고리별 breakdown

2. **규칙/스코어 튜닝**
   - DSL 룰/매핑/Recon 스코어 weight 조정
   - Low-confidence → 수동 검토 fallback 비율 최적화

3. **모바일 CI 강화**
   - EAS 토큰 보유 시 안드로이드 프리뷰 빌드를 릴리스 게이트에 승격
   - (이미 `release.yml`의 `needs`에 `gate_mobile` 연결됨)

## 메트릭 및 KPI

### 성능
- p95 latency: 목표 ≤ 300ms
- 5xx error rate: 목표 < 0.5% (10분 윈도)
- 가용성: 목표 99.9%

### 사용성
- 오프라인 큐 자동 플러시 성공률
- 수동 검토 요청 처리 시간
- Backoffice 화면 로딩 시간

### 정확도
- Top-1 정확도: 목표 ≥ 70%
- Top-5 정확도: 목표 ≥ 85%
- 수동 검토 비율: 목표 < 10%

## 다음 액션 아이템

1. ✅ R7-S3 PR 생성 및 병합
2. ✅ 태그 릴리스 (`r7-final-YYYYMMDD`)
3. ⏳ 파일럿 테넌트 온보딩
4. ⏳ 모니터링 대시보드 구축
5. ⏳ 골든셋 확대 및 분석
6. ⏳ 규칙/스코어 튜닝

